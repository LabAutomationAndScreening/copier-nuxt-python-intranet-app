{% raw %}# aws ecr get-login-password --region us-east-1{% endraw %}{% if pull_from_ecr %}{% raw %} --profile={% endraw %}{{ core_infra_base_access_profile_name }}{% endif %}{% raw %} | docker login --username AWS --password-stdin {% endraw %}{{ frontend_ecr_base_url }}{% raw %}
# for when running unit tests to create VCRpy cassettes and you don't want the app itself running (TODO: consider using docker compose profiles instead): docker-compose up --scale frontend=0{% endraw %}{% if has_backend %}{% raw %} --scale backend=0{% endraw %}{% endif %}{% raw %}
services:{% endraw %}{% if has_backend %}{% raw %}
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: {% endraw %}{{ repo_name }}{% raw %}-backend
    ports:
      - "{% endraw %}{{ backend_deployed_port_number }}{% raw %}:{% endraw %}{{ backend_deployed_port_number }}{% raw %}"
    environment:
      API_PORT: {% endraw %}{{ backend_deployed_port_number }}{% raw %}
    volumes:
      - ./docker-compose-logs:/app/logs
    restart: unless-stopped
    network_mode: host
{% endraw %}{% endif %}{% raw %}
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: {% endraw %}{{ repo_name }}{% raw %}-frontend
    ports:
      - "{% endraw %}{{ frontend_deployed_port_number }}{% raw %}:{% endraw %}{{ frontend_deployed_port_number }}{% raw %}"{% endraw %}{% if has_backend %}{% raw %}
    depends_on:
      - backend{% endraw %}{% endif %}{% raw %}
    environment:
      BACKEND_HOST: host.docker.internal
      BACKEND_PORT: {% endraw %}{{ backend_deployed_port_number }}{% raw %}
      FRONTEND_PORT: {% endraw %}{{ frontend_deployed_port_number }}{% raw %}
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"{% endraw %}
